% Michał weź zrób jakieś slajdy z tymi obrazkami czy cuś
\documentclass[a4paper,12pt]{article}
\usepackage[polish]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{indentfirst}
\usepackage[top=2.5cm, bottom=2.5cm, left=2.5cm, right=2.5cm]{geometry}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{listings}

\title{Symulacja ruchu drogowego na IV obwodnicy Krakowa}
\author{Szymon Gałuszka, Michał Worsowicz, Maciej Nalepa}
\date{\today}
\begin{document}
    \maketitle

    \part{Omówienie projektu}

	\section{Definicja problemu}
	
	Nasz cel to symulacja ruchu drogowego na IV obwodnicy Krakowa.
	Konieczna jest definicja tras oraz sposobu poruszania się po nich.
	Obwodnica tworzy zamkniętą pętlę (uwzględniając odcinek w budowie) i dzieli się na ruch zgodny i przeciwny do wsazówek zegara.
	
	Ruch drogowy powinien uwzględniać pojazdy osobowe, ciężarowe i transport publiczny.
	Ciężkie pojazdy obowiązują inne ograniczenia prędkości oraz zajmują więcej przestrzeni na jezdni.
	Napływ ruchu powinien odbywać się przez wjazdy na obwodnicę, które wpuszczają samochody z określoną częstotliwością, która może zależeć od pory dnia.
	
	Symulacja może obejmować wydarzenia losowe, takie jak:
	
	\begin{itemize}
		\item blokada pasa ruchu,
		\item zamknięcie zjazdu,
		\item nagłe hamowanie.
    \end{itemize}
    
    \section{Obszar symulacji}
    % Obwodnica IV - szczegóły trasy
	Symulowany przez nas obszar to IV obwodnica Krakowa, znana także jako obwodnica autostradowa Krakowa, ponieważ większość jej odcinka stanowi autostrada A4.
	
	Na obwodnicy nie ma sygnalizacji świetlnej, skrzyżowania znajdują się najczęściej pod wiaduktem i najpierw należy zjechać z drogi szybkiego ruchu.
	Trasa ma zróżnicowane ograniczenia prędkości oraz różną ilość pasów ruchu.
	
	Fragment ten na zachodnich obrzeżach miasta jest dwupasmowy, a na południowych - trójpasmowy. W najbliższym czasie przewidywana jest budowa odcinka północnego, który uwzględniliśmy w naszej symulacji, odtwarzając i dodając ten fragment do projektu. Poniżej przedstawiony jest wykaz węzłów drogowych, które obejmuje symulacja (zgodnie z kierunkiem ruchu wskazówek zegara):
	
	\begin{itemize}
		\item Kraków Nowa Huta,
		\item Kraków Przewóz,
		\item Kraków Bieżanów,
		\item Kraków Wieliczka,
		\item Kraków Łagiewniki,
		\item Kraków Południe,
		\item Kraków Skawina,
		\item Kraków Tyniec,
		\item Kraków Bielany,
		\item Kraków Balice (lotnisko),
		\item Balice I,
		\item Modlniczka,
		\item Modlnica,
		\item Kraków Północ -- dla uproszczenia przyjęto taką nazwę planowanego węzła (wariant I)
	\end{itemize}

    \section{Algorytm}
    % Nagel-Schreckenberg
    Zastosowany przez nas algorytm ruchu drogowego to zmodyfikowany model Nagela-Schreckenberga, będący teoretycznym modelem mikroskopowym o charakterze dyskretnym, w którym obie jednokierunkowe jezdnie są podzielone na komórki, które zawierają informację na temat ilości pasów oraz ilości pojazdów w danej chwili na jezdni. Dzięki takiemu uproszczeniu, nie jest konieczna symulacja zmiany pasu ruchu, ponieważ nie jest on określony wprost.
    
    Każda z komórek może być interpretowana na jeden ze sposobów:
    
    \begin{itemize}
    	\item komórka pusta -- fragment pustej drogi
    	\item komórka używana -- fragment zawierający pojazd na nieokreślonym pasie
    	\item komórka pełna -- fragment drogi z pojazdem na wszystkich pasach ruchu
    \end{itemize}

	Każdy samochód $n$ posiada swoją prędkość $v(n)$ o wartości liczby naturalnej, nie większej od prędkości maksymalnej $v_{max}$ -- symbolizuje ona maksymalną prędkość osiąganą przez samochód.
	
	Czas $t$ w modelu Nagela-Schreckenberga przyjmuje wartość dyskretną o stałym kroku, gdzie każdy etap można podzielić na cztery następujące po sobie czynności:

	\begin{enumerate}
		\item Losowość: \\
		Czynność ta symbolizuje wszelkie przypadki losowe z jakimi kierowca może spotkać się na drodze. Dla każdego samochodu $n$ prędkość może zostać zmniejszona, zwiększona lub dopasowana do ograniczenia na drodze.
		\item Ruch: \\
		Jeżeli odległość $d(n)$ samochodu $n$ od samochodu znajdującego się przed nim jest mniejsza od prędkości $v(n)$ tego samochodu to prędkość samochodu ulega zmniejszeniu. Jako że odległość mierzona jest w liczbie komórek, a prędkość w liczbie komórek na jednostkę czasu, to prędkość ostateczna może wynosić maksymalnie $d(n)$ na jednostkę czasu, a minimalnie zero.
	\end{enumerate}

    \part{Realizacja}
    
    \section{Struktury danych}
    % Struktura projektu
    Obsługiwany plik mapy jest w formacie \texttt{json} i przybiera następującą formę:
    \begin{center}
    	\begin{lstlisting}
    	{
    		"nazwa wjazdu;nazwa zjazdu": {
    			"lanes": liczba_pasów,
    			"maxspeed": ograniczenie_prędkości,
    			"geometry": [
    				[lat, lon],
    				...
    			]
    		},
    		...
    	}
    	\end{lstlisting}
    \end{center}
    
    Automat komórkowy -- \texttt{Cellular} przechowuje listę następujących obiektów: pojazdów (agentów), komórek, punktów startowych i końcowych.
    Umożliwia budowanie mapy na podstawie pliku \texttt{json} kompatybilnego z modułem opracowania własnego \texttt{SimpleMap}.

    \section{Implementacja}
    % Wytłumaczenie rozwiązania problemu

    \section{Usprawnienie}
    % Słabe punkty implementacji, co działa za wolno lub niestabilnie
    Zapis jednego stanu mapy to ramka danych o rozmiarze ilości komórek na mapie. Oznacza to, że pojedyńcza sekunda symulacji generuje nawet 30000 wpisów do ramki. W celu uniknięcia problemu z zapełnianiem pamięci stworzono specjalną klasę \texttt{LastCellStat} przechowującą określoną ilość stanów wstecz.
    Lepszym rozwiązeniem może być zapis logów bezpośrednio do pliku.
    
    Konfiguracja prawdopodobieństwa opuszczenia skrzyżowania jest globalna, powinna być zależna od węzła.

    \part{Podsumowanie}

    \section{Wyniki}
    % Opis symulacji i wpływu parametrów na model    
	Wszystko jest gites i działa!
		
    \section{Od autorów}
    % Nasze przemyślenia o projekcie, napotkane trudności
    Nasz framework umożliwa w obecnym stanie analizę interesującego parametru: średniego czasu jaki samochód spędza na obwodnicy. Postanowiliśmy zostawić to jako propozycję do samodzielnego eksperymentu z tą symulacją.

    \section{Dalsza praca}
    % Uproszczenia i części wymagające ulepszeń lub optymalizacji
    % Nie umieszczamy ich w projekcie, ale zaznaczamy od czego zacząć aby projekt usprawnić
    Aby uczynić projekt bardziej uniwersalnym, należy dodać obsługę innych zaawansowanych map.
    Można to zrobić poprzez rozbudowanie obecnego modułu \texttt{SimpleMap} lub zaimplementować obsługę znanych już formatów, np. OpenStreetMap, Google MyMaps.
    
    Projekt nie posiada innych pojazdów, niż domyślny osobowy. Zatem pierwszym usprawnieniem jest wprowadzenie pojazdów, które: 
    
    \begin{itemize}
    	\item obowiązują inne ograniczenia prędkości
    	\item zajmują więcej, niż jedną komórkę
    \end{itemize}

	Obsługa całej platformy może zostać zawarta w wygodnej dla użytkownika oprawie graficznej, np. \texttt{kivy}. Na chwilę obecną najbardziej interaktywny interfejs uzyskujemy poprzez \texttt{jupyter notebook}, który ma duże ograniczenia wydajności.

	\pagebreak
	\begin{thebibliography}{15}
		\bibitem{wikikrk}
		Wiki, \textit{Kraków Obwodnica IV},
		\texttt{\href{https://pl.wikipedia.org/wiki/Obwodnice_Krakowa\#IV_obwodnica}{wikipedia.org}}
		
		\bibitem{map}
		OpenStreet, \textit{mapa},
		\texttt{\href{https://www.openstreetmap.org/}{openstreetmap.org}}
		
		\bibitem{nagel}
		K. Nagel, M. Schreckenberg, \textit{Two lane traffic simulations using cellular automata},
		\texttt{\href{https://arxiv.org/pdf/cond-mat/9512119.pdf}{arxiv.org}}
		% https://www.sciencedirect.com/science/article/pii/0378437195004424
	\end{thebibliography}
	
\end{document}
